<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>12ã€çº¿ç¨‹æ± åŸç† | ç„¦ç³–å’–å•¡</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/blog/img/favicon.ico">
    <meta name="description" content="å†™ç‚¹ä¸œè¥¿">
    <meta name="keywords" content="å†™ç‚¹ä¸œè¥¿">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/blog/assets/css/0.styles.6741cb35.css" as="style"><link rel="preload" href="/blog/assets/js/app.efd2e688.js" as="script"><link rel="preload" href="/blog/assets/js/2.5f0b0e2a.js" as="script"><link rel="preload" href="/blog/assets/js/26.6c5d9435.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.749c9b38.js"><link rel="prefetch" href="/blog/assets/js/11.93593656.js"><link rel="prefetch" href="/blog/assets/js/12.f7a669f9.js"><link rel="prefetch" href="/blog/assets/js/13.30867c4c.js"><link rel="prefetch" href="/blog/assets/js/14.8f687624.js"><link rel="prefetch" href="/blog/assets/js/15.0f16543b.js"><link rel="prefetch" href="/blog/assets/js/16.186438af.js"><link rel="prefetch" href="/blog/assets/js/17.ef2aeaef.js"><link rel="prefetch" href="/blog/assets/js/18.e5159ce1.js"><link rel="prefetch" href="/blog/assets/js/19.f90bdb84.js"><link rel="prefetch" href="/blog/assets/js/20.6839a0a7.js"><link rel="prefetch" href="/blog/assets/js/21.d9fc8f99.js"><link rel="prefetch" href="/blog/assets/js/22.23dfa9a2.js"><link rel="prefetch" href="/blog/assets/js/23.c2a738df.js"><link rel="prefetch" href="/blog/assets/js/24.b071ec38.js"><link rel="prefetch" href="/blog/assets/js/25.921f2338.js"><link rel="prefetch" href="/blog/assets/js/27.481a0ad6.js"><link rel="prefetch" href="/blog/assets/js/28.b96ebb80.js"><link rel="prefetch" href="/blog/assets/js/29.93faac78.js"><link rel="prefetch" href="/blog/assets/js/3.14b9b7a6.js"><link rel="prefetch" href="/blog/assets/js/30.3ddabff3.js"><link rel="prefetch" href="/blog/assets/js/31.53da9a42.js"><link rel="prefetch" href="/blog/assets/js/32.36788ab9.js"><link rel="prefetch" href="/blog/assets/js/33.e0508007.js"><link rel="prefetch" href="/blog/assets/js/34.aae391c5.js"><link rel="prefetch" href="/blog/assets/js/35.1bc776d8.js"><link rel="prefetch" href="/blog/assets/js/36.644af5cf.js"><link rel="prefetch" href="/blog/assets/js/37.1c0492ce.js"><link rel="prefetch" href="/blog/assets/js/38.3b558c36.js"><link rel="prefetch" href="/blog/assets/js/39.a92ca3bf.js"><link rel="prefetch" href="/blog/assets/js/4.f535c559.js"><link rel="prefetch" href="/blog/assets/js/40.4098a30f.js"><link rel="prefetch" href="/blog/assets/js/41.a0c6763c.js"><link rel="prefetch" href="/blog/assets/js/42.846c2a3b.js"><link rel="prefetch" href="/blog/assets/js/43.804b0b6a.js"><link rel="prefetch" href="/blog/assets/js/44.80537e6e.js"><link rel="prefetch" href="/blog/assets/js/45.511e6efc.js"><link rel="prefetch" href="/blog/assets/js/5.a694496e.js"><link rel="prefetch" href="/blog/assets/js/6.124a8456.js"><link rel="prefetch" href="/blog/assets/js/7.b0bb40e3.js"><link rel="prefetch" href="/blog/assets/js/8.2fb1b0a3.js"><link rel="prefetch" href="/blog/assets/js/9.96c5e5cc.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.6741cb35.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="ç›®å½•" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/img/caramel.svg" alt="ç„¦ç³–å’–å•¡" class="logo"> <span class="site-name can-hide">ç„¦ç³–å’–å•¡</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="â˜•ï¸ Back-end" class="dropdown-title"><a href="/blog/backend/" class="link-title">â˜•ï¸ Back-end</a> <span class="title" style="display:none;">â˜•ï¸ Back-end</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/pages/2180198A4D054652/" class="nav-link">ğŸ¦ Mybatis</a></li><li class="dropdown-item"><!----> <a href="/blog/pages/456/" class="nav-link">ğŸ€ Spring</a></li><li class="dropdown-item"><!----> <a href="/blog/pages/7F29642A19662951/" class="nav-link">ğŸ”€ å¹¶å‘</a></li><li class="dropdown-item"><!----> <a href="/blog/pages/33226E4C1DB2BCEA/" class="nav-link">ğŸ—’ æ—¥å¿—æŠ€æœ¯</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ğŸ§ Linux" class="dropdown-title"><a href="/blog/linux/" class="link-title">ğŸ§ Linux</a> <span class="title" style="display:none;">ğŸ§ Linux</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/pages/53E52BA23D40007F/" class="nav-link">ğŸ‡¨ğŸ‡³ Deepin</a></li><li class="dropdown-item"><!----> <a href="/blog/pages/6541198C83D77024/" class="nav-link">ğŸ“ Raspberry</a></li><li class="dropdown-item"><h4>ğŸ MacOS</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/note/javascript/" class="nav-link">ã€ŠJavaScriptæ•™ç¨‹ã€‹</a></li><li class="dropdown-subitem"><a href="/blog/note/js/" class="nav-link">ã€ŠJavaScripté«˜çº§ç¨‹åºè®¾è®¡ã€‹</a></li><li class="dropdown-subitem"><a href="/blog/note/es6/" class="nav-link">ã€ŠES6 æ•™ç¨‹ã€‹</a></li><li class="dropdown-subitem"><a href="/blog/note/vue/" class="nav-link">ã€ŠVueã€‹</a></li><li class="dropdown-subitem"><a href="/blog/note/react/" class="nav-link">ã€ŠReactã€‹</a></li><li class="dropdown-subitem"><a href="/blog/note/typescript-axios/" class="nav-link">ã€ŠTypeScript ä»é›¶å®ç° axiosã€‹</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ğŸ›¢ Database" class="dropdown-title"><a href="/blog/database/" class="link-title">ğŸ›¢ Database</a> <span class="title" style="display:none;">ğŸ›¢ Database</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/pages/8309a5b876fc95e3/" class="nav-link">ğŸ¬ MySQL</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ğŸ–¥ Front-end" class="dropdown-title"><a href="/blog/frontend/" class="link-title">ğŸ–¥ Front-end</a> <span class="title" style="display:none;">ğŸ–¥ Front-end</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/pages/9a7ee40fc232253e/" class="nav-link">æŠ€æœ¯æ–‡æ¡£</a></li><li class="dropdown-item"><!----> <a href="/blog/pages/4c778760be26d8b3/" class="nav-link">GitHubæŠ€å·§</a></li><li class="dropdown-item"><!----> <a href="/blog/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/blog/pages/41f87d890d0a02af/" class="nav-link">åšå®¢æ­å»º</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ğŸ’Š Other" class="dropdown-title"><a href="/blog/other/" class="link-title">ğŸ’Š Other</a> <span class="title" style="display:none;">ğŸ’Š Other</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/pages/f2a556/" class="nav-link">å­¦ä¹ </a></li><li class="dropdown-item"><!----> <a href="/blog/pages/aea6571b7a8bae86/" class="nav-link">é¢è¯•</a></li><li class="dropdown-item"><!----> <a href="/blog/pages/2d615df9a36a98ed/" class="nav-link">å¿ƒæƒ…æ‚è´§</a></li><li class="dropdown-item"><!----> <a href="/blog/pages/baaa02/" class="nav-link">å®ç”¨æŠ€å·§</a></li><li class="dropdown-item"><!----> <a href="/blog/friends/" class="nav-link">å‹æƒ…é“¾æ¥</a></li></ul></div></div><div class="nav-item"><a href="/blog/personal/" class="nav-link">ğŸ” Personal</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="â­ï¸ Favorite" class="dropdown-title"><a href="/blog/favorite/" class="link-title">â­ï¸ Favorite</a> <span class="title" style="display:none;">â­ï¸ Favorite</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/pages/beb6c0bd8a66cea6/" class="nav-link">ç½‘ç«™</a></li><li class="dropdown-item"><!----> <a href="/blog/pages/eee83a9211a70f9d/" class="nav-link">èµ„æº</a></li><li class="dropdown-item"><!----> <a href="/blog/pages/12df8ace52d493f6/" class="nav-link">Vueèµ„æº</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ğŸš€ Index" class="dropdown-title"><a href="/blog/index/" class="link-title">ğŸš€ Index</a> <span class="title" style="display:none;">ğŸš€ Index</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/categories/" class="nav-link">åˆ†ç±»</a></li><li class="dropdown-item"><!----> <a href="/blog/tags/" class="nav-link">æ ‡ç­¾</a></li><li class="dropdown-item"><!----> <a href="/blog/archives/" class="nav-link">å½’æ¡£</a></li></ul></div></div> <a href="https://github.com/Fitminf" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://fitminfpicgo.oss-cn-guangzhou.aliyuncs.com/picgo/202209221704957.jpeg"> <div class="blogger-info"><h3>Fitminf</h3> <span>é›¾é‡Œçœ‹èŠ±</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="â˜•ï¸ Back-end" class="dropdown-title"><a href="/blog/backend/" class="link-title">â˜•ï¸ Back-end</a> <span class="title" style="display:none;">â˜•ï¸ Back-end</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/pages/2180198A4D054652/" class="nav-link">ğŸ¦ Mybatis</a></li><li class="dropdown-item"><!----> <a href="/blog/pages/456/" class="nav-link">ğŸ€ Spring</a></li><li class="dropdown-item"><!----> <a href="/blog/pages/7F29642A19662951/" class="nav-link">ğŸ”€ å¹¶å‘</a></li><li class="dropdown-item"><!----> <a href="/blog/pages/33226E4C1DB2BCEA/" class="nav-link">ğŸ—’ æ—¥å¿—æŠ€æœ¯</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ğŸ§ Linux" class="dropdown-title"><a href="/blog/linux/" class="link-title">ğŸ§ Linux</a> <span class="title" style="display:none;">ğŸ§ Linux</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/pages/53E52BA23D40007F/" class="nav-link">ğŸ‡¨ğŸ‡³ Deepin</a></li><li class="dropdown-item"><!----> <a href="/blog/pages/6541198C83D77024/" class="nav-link">ğŸ“ Raspberry</a></li><li class="dropdown-item"><h4>ğŸ MacOS</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/note/javascript/" class="nav-link">ã€ŠJavaScriptæ•™ç¨‹ã€‹</a></li><li class="dropdown-subitem"><a href="/blog/note/js/" class="nav-link">ã€ŠJavaScripté«˜çº§ç¨‹åºè®¾è®¡ã€‹</a></li><li class="dropdown-subitem"><a href="/blog/note/es6/" class="nav-link">ã€ŠES6 æ•™ç¨‹ã€‹</a></li><li class="dropdown-subitem"><a href="/blog/note/vue/" class="nav-link">ã€ŠVueã€‹</a></li><li class="dropdown-subitem"><a href="/blog/note/react/" class="nav-link">ã€ŠReactã€‹</a></li><li class="dropdown-subitem"><a href="/blog/note/typescript-axios/" class="nav-link">ã€ŠTypeScript ä»é›¶å®ç° axiosã€‹</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ğŸ›¢ Database" class="dropdown-title"><a href="/blog/database/" class="link-title">ğŸ›¢ Database</a> <span class="title" style="display:none;">ğŸ›¢ Database</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/pages/8309a5b876fc95e3/" class="nav-link">ğŸ¬ MySQL</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ğŸ–¥ Front-end" class="dropdown-title"><a href="/blog/frontend/" class="link-title">ğŸ–¥ Front-end</a> <span class="title" style="display:none;">ğŸ–¥ Front-end</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/pages/9a7ee40fc232253e/" class="nav-link">æŠ€æœ¯æ–‡æ¡£</a></li><li class="dropdown-item"><!----> <a href="/blog/pages/4c778760be26d8b3/" class="nav-link">GitHubæŠ€å·§</a></li><li class="dropdown-item"><!----> <a href="/blog/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/blog/pages/41f87d890d0a02af/" class="nav-link">åšå®¢æ­å»º</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ğŸ’Š Other" class="dropdown-title"><a href="/blog/other/" class="link-title">ğŸ’Š Other</a> <span class="title" style="display:none;">ğŸ’Š Other</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/pages/f2a556/" class="nav-link">å­¦ä¹ </a></li><li class="dropdown-item"><!----> <a href="/blog/pages/aea6571b7a8bae86/" class="nav-link">é¢è¯•</a></li><li class="dropdown-item"><!----> <a href="/blog/pages/2d615df9a36a98ed/" class="nav-link">å¿ƒæƒ…æ‚è´§</a></li><li class="dropdown-item"><!----> <a href="/blog/pages/baaa02/" class="nav-link">å®ç”¨æŠ€å·§</a></li><li class="dropdown-item"><!----> <a href="/blog/friends/" class="nav-link">å‹æƒ…é“¾æ¥</a></li></ul></div></div><div class="nav-item"><a href="/blog/personal/" class="nav-link">ğŸ” Personal</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="â­ï¸ Favorite" class="dropdown-title"><a href="/blog/favorite/" class="link-title">â­ï¸ Favorite</a> <span class="title" style="display:none;">â­ï¸ Favorite</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/pages/beb6c0bd8a66cea6/" class="nav-link">ç½‘ç«™</a></li><li class="dropdown-item"><!----> <a href="/blog/pages/eee83a9211a70f9d/" class="nav-link">èµ„æº</a></li><li class="dropdown-item"><!----> <a href="/blog/pages/12df8ace52d493f6/" class="nav-link">Vueèµ„æº</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ğŸš€ Index" class="dropdown-title"><a href="/blog/index/" class="link-title">ğŸš€ Index</a> <span class="title" style="display:none;">ğŸš€ Index</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/categories/" class="nav-link">åˆ†ç±»</a></li><li class="dropdown-item"><!----> <a href="/blog/tags/" class="nav-link">æ ‡ç­¾</a></li><li class="dropdown-item"><!----> <a href="/blog/archives/" class="nav-link">å½’æ¡£</a></li></ul></div></div> <a href="https://github.com/Fitminf" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MyBatis</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spring</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>å¹¶å‘</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>å¤šçº¿ç¨‹åŸºç¡€</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/pages/7F29642A19662951/" class="sidebar-link">å¤šçº¿ç¨‹åŸºç¡€-å‰è¨€</a></li><li><a href="/blog/pages/A12A191E28132E90/" class="sidebar-link">01ã€è¿›ç¨‹ä¸çº¿ç¨‹çš„åŸºæœ¬æ¦‚å¿µ</a></li><li><a href="/blog/pages/6F7217E6CCF8856B/" class="sidebar-link">02ã€Javaå¤šçº¿ç¨‹å…¥é—¨ç±»å’Œæ¥å£</a></li><li><a href="/blog/pages/fa8f85/" class="sidebar-link">03ã€çº¿ç¨‹ç»„å’Œçº¿ç¨‹ä¼˜å…ˆçº§</a></li><li><a href="/blog/pages/63a0a4/" class="sidebar-link">04ã€Javaçº¿ç¨‹çš„çŠ¶æ€åŠä¸»è¦è½¬åŒ–æ–¹æ³•</a></li><li><a href="/blog/pages/F87958560134D1A3/" class="sidebar-link">05ã€Javaçº¿ç¨‹é—´çš„é€šä¿¡</a></li><li><a href="/blog/pages/C34B59402BB72DBA/" class="sidebar-link">06ã€Javaå†…å­˜æ¨¡å‹åŸºç¡€çŸ¥è¯†</a></li><li><a href="/blog/pages/7B66C7861139D2B5/" class="sidebar-link">07ã€é‡æ’åºä¸happens-before</a></li><li><a href="/blog/pages/898B90EBCA2D62EB/" class="sidebar-link">08ã€volatile</a></li><li><a href="/blog/pages/0FEB9B2E56576762/" class="sidebar-link">09ã€synchronizedä¸é”</a></li><li><a href="/blog/pages/B863F1BE15DCC432/" class="sidebar-link">10ã€CASä¸åŸå­æ“ä½œ</a></li><li><a href="/blog/pages/E658D79B41195139/" class="sidebar-link">11ã€AQS</a></li><li><a href="/blog/pages/9CFA55CB21359278/" aria-current="page" class="active sidebar-link">12ã€çº¿ç¨‹æ± åŸç†</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/blog/pages/9CFA55CB21359278/#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¿ç¨‹æ± " class="sidebar-link">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¿ç¨‹æ± </a></li><li class="sidebar-sub-header level2"><a href="/blog/pages/9CFA55CB21359278/#çº¿ç¨‹æ± çš„åŸç†" class="sidebar-link">çº¿ç¨‹æ± çš„åŸç†</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/blog/pages/9CFA55CB21359278/#threadpoolexecutoræä¾›çš„æ„é€ æ–¹æ³•" class="sidebar-link">ThreadPoolExecutoræä¾›çš„æ„é€ æ–¹æ³•</a></li><li class="sidebar-sub-header level3"><a href="/blog/pages/9CFA55CB21359278/#threadpoolexecutorçš„ç­–ç•¥" class="sidebar-link">ThreadPoolExecutorçš„ç­–ç•¥</a></li><li class="sidebar-sub-header level3"><a href="/blog/pages/9CFA55CB21359278/#çº¿ç¨‹æ± ä¸»è¦çš„ä»»åŠ¡å¤„ç†æµç¨‹" class="sidebar-link">çº¿ç¨‹æ± ä¸»è¦çš„ä»»åŠ¡å¤„ç†æµç¨‹</a></li><li class="sidebar-sub-header level3"><a href="/blog/pages/9CFA55CB21359278/#threadpoolexecutorå¦‚ä½•åšåˆ°çº¿ç¨‹å¤ç”¨çš„" class="sidebar-link">ThreadPoolExecutorå¦‚ä½•åšåˆ°çº¿ç¨‹å¤ç”¨çš„ï¼Ÿ</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/blog/pages/9CFA55CB21359278/#å››ç§å¸¸è§çš„çº¿ç¨‹æ± " class="sidebar-link">å››ç§å¸¸è§çš„çº¿ç¨‹æ± </a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/blog/pages/9CFA55CB21359278/#newcachedthreadpool" class="sidebar-link">newCachedThreadPool</a></li><li class="sidebar-sub-header level3"><a href="/blog/pages/9CFA55CB21359278/#newfixedthreadpool" class="sidebar-link">newFixedThreadPool</a></li><li class="sidebar-sub-header level3"><a href="/blog/pages/9CFA55CB21359278/#newsinglethreadexecutor" class="sidebar-link">newSingleThreadExecutor</a></li><li class="sidebar-sub-header level3"><a href="/blog/pages/9CFA55CB21359278/#newscheduledthreadpool" class="sidebar-link">newScheduledThreadPool</a></li></ul></li></ul></li><li><a href="/blog/pages/345A4BC7620A2B1A/" class="sidebar-link">13ã€é˜»å¡é˜Ÿåˆ—</a></li><li><a href="/blog/pages/A1294429F0B7CD83/" class="sidebar-link">14 ã€é”æ¥å£å’Œç±»</a></li><li><a href="/blog/pages/C2BEC069DEF424FB/" class="sidebar-link">15ã€å¹¶å‘å®¹å™¨é›†åˆ</a></li><li><a href="/blog/pages/FA3A94F4692FE42A/" class="sidebar-link">16ã€CopyOnWriteå®¹å™¨</a></li><li><a href="/blog/pages/28F16A453F176057/" class="sidebar-link">17ã€é€šä¿¡å·¥å…·ç±»</a></li><li><a href="/blog/pages/ADD7D4486BAD1826/" class="sidebar-link">18ã€Forkã€Joinæ¡†æ¶</a></li><li><a href="/blog/pages/7EBF85E5E461278E/" class="sidebar-link">19ã€Java 8 Streamå¹¶è¡Œè®¡ç®—åŸç†</a></li><li><a href="/blog/pages/97DB848CDF0349FE/" class="sidebar-link">20ã€è®¡åˆ’ä»»åŠ¡</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æ—¥å¿—æŠ€æœ¯</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/blog/" title="é¦–é¡µ" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/blog/backend/#åç«¯" data-v-06225672>åç«¯</a></li><li data-v-06225672><a href="/blog/backend/#å¹¶å‘" data-v-06225672>å¹¶å‘</a></li><li data-v-06225672><a href="/blog/backend/#å¤šçº¿ç¨‹åŸºç¡€" data-v-06225672>å¤šçº¿ç¨‹åŸºç¡€</a></li></ul> <div class="info" data-v-06225672><div title="ä½œè€…" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/Fitminf" target="_blank" title="ä½œè€…" class="beLink" data-v-06225672>fitminf</a></div> <div title="åˆ›å»ºæ—¶é—´" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-09-29</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">ç›®å½•</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">12ã€çº¿ç¨‹æ± åŸç†<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="çº¿ç¨‹æ± åŸç†"><a href="#çº¿ç¨‹æ± åŸç†" class="header-anchor">#</a> çº¿ç¨‹æ± åŸç†</h1> <h2 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¿ç¨‹æ± "><a href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¿ç¨‹æ± " class="header-anchor">#</a> ä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¿ç¨‹æ± </h2> <p>ä½¿ç”¨çº¿ç¨‹æ± ä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ä¸ªåŸå› ï¼š</p> <ol><li>åˆ›å»º/é”€æ¯çº¿ç¨‹éœ€è¦æ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œçº¿ç¨‹æ± å¯ä»¥<strong>å¤ç”¨å·²åˆ›å»ºçš„çº¿ç¨‹</strong>ã€‚</li> <li><strong>æ§åˆ¶å¹¶å‘çš„æ•°é‡</strong>ã€‚å¹¶å‘æ•°é‡è¿‡å¤šï¼Œå¯èƒ½ä¼šå¯¼è‡´èµ„æºæ¶ˆè€—è¿‡å¤šï¼Œä»è€Œé€ æˆæœåŠ¡å™¨å´©æºƒã€‚ï¼ˆä¸»è¦åŸå› ï¼‰</li> <li><strong>å¯ä»¥å¯¹çº¿ç¨‹åšç»Ÿä¸€ç®¡ç†</strong>ã€‚</li></ol> <h2 id="çº¿ç¨‹æ± çš„åŸç†"><a href="#çº¿ç¨‹æ± çš„åŸç†" class="header-anchor">#</a> çº¿ç¨‹æ± çš„åŸç†</h2> <p>Javaä¸­çš„çº¿ç¨‹æ± é¡¶å±‚æ¥å£æ˜¯<code>Executor</code>æ¥å£ï¼Œ<code>ThreadPoolExecutor</code>æ˜¯è¿™ä¸ªæ¥å£çš„å®ç°ç±»ã€‚</p> <p>æˆ‘ä»¬å…ˆçœ‹çœ‹<code>ThreadPoolExecutor</code>ç±»ã€‚</p> <h3 id="threadpoolexecutoræä¾›çš„æ„é€ æ–¹æ³•"><a href="#threadpoolexecutoræä¾›çš„æ„é€ æ–¹æ³•" class="header-anchor">#</a> ThreadPoolExecutoræä¾›çš„æ„é€ æ–¹æ³•</h3> <p>ä¸€å…±æœ‰å››ä¸ªæ„é€ æ–¹æ³•ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// äº”ä¸ªå‚æ•°çš„æ„é€ å‡½æ•°</span>
<span class="token keyword">public</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token keyword">int</span> corePoolSize<span class="token punctuation">,</span>
                          <span class="token keyword">int</span> maximumPoolSize<span class="token punctuation">,</span>
                          <span class="token keyword">long</span> keepAliveTime<span class="token punctuation">,</span>
                          <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">,</span>
                          <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span> workQueue<span class="token punctuation">)</span>

<span class="token comment">// å…­ä¸ªå‚æ•°çš„æ„é€ å‡½æ•°-1</span>
<span class="token keyword">public</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token keyword">int</span> corePoolSize<span class="token punctuation">,</span>
                          <span class="token keyword">int</span> maximumPoolSize<span class="token punctuation">,</span>
                          <span class="token keyword">long</span> keepAliveTime<span class="token punctuation">,</span>
                          <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">,</span>
                          <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span> workQueue<span class="token punctuation">,</span>
                          <span class="token class-name">ThreadFactory</span> threadFactory<span class="token punctuation">)</span>

<span class="token comment">// å…­ä¸ªå‚æ•°çš„æ„é€ å‡½æ•°-2</span>
<span class="token keyword">public</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token keyword">int</span> corePoolSize<span class="token punctuation">,</span>
                          <span class="token keyword">int</span> maximumPoolSize<span class="token punctuation">,</span>
                          <span class="token keyword">long</span> keepAliveTime<span class="token punctuation">,</span>
                          <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">,</span>
                          <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span> workQueue<span class="token punctuation">,</span>
                          <span class="token class-name">RejectedExecutionHandler</span> handler<span class="token punctuation">)</span>

<span class="token comment">// ä¸ƒä¸ªå‚æ•°çš„æ„é€ å‡½æ•°</span>
<span class="token keyword">public</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token keyword">int</span> corePoolSize<span class="token punctuation">,</span>
                          <span class="token keyword">int</span> maximumPoolSize<span class="token punctuation">,</span>
                          <span class="token keyword">long</span> keepAliveTime<span class="token punctuation">,</span>
                          <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">,</span>
                          <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span> workQueue<span class="token punctuation">,</span>
                          <span class="token class-name">ThreadFactory</span> threadFactory<span class="token punctuation">,</span>
                          <span class="token class-name">RejectedExecutionHandler</span> handler<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>æ¶‰åŠåˆ°5~7ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹å¿…é¡»çš„5ä¸ªå‚æ•°æ˜¯ä»€ä¹ˆæ„æ€ï¼š</p> <ul><li><p><strong>int corePoolSize</strong>ï¼šè¯¥çº¿ç¨‹æ± ä¸­<strong>æ ¸å¿ƒçº¿ç¨‹æ•°æœ€å¤§å€¼</strong></p> <blockquote><p>æ ¸å¿ƒçº¿ç¨‹ï¼šçº¿ç¨‹æ± ä¸­æœ‰ä¸¤ç±»çº¿ç¨‹ï¼Œæ ¸å¿ƒçº¿ç¨‹å’Œéæ ¸å¿ƒçº¿ç¨‹ã€‚æ ¸å¿ƒçº¿ç¨‹é»˜è®¤æƒ…å†µä¸‹ä¼šä¸€ç›´å­˜åœ¨äºçº¿ç¨‹æ± ä¸­ï¼Œå³ä½¿è¿™ä¸ªæ ¸å¿ƒçº¿ç¨‹ä»€ä¹ˆéƒ½ä¸å¹²ï¼ˆé“é¥­ç¢—ï¼‰ï¼Œè€Œéæ ¸å¿ƒçº¿ç¨‹å¦‚æœé•¿æ—¶é—´çš„é—²ç½®ï¼Œå°±ä¼šè¢«é”€æ¯ï¼ˆä¸´æ—¶å·¥ï¼‰ã€‚</p></blockquote></li> <li><p><strong>int maximumPoolSize</strong>ï¼šè¯¥çº¿ç¨‹æ± ä¸­<strong>çº¿ç¨‹æ€»æ•°æœ€å¤§å€¼</strong> ã€‚</p> <blockquote><p>è¯¥å€¼ç­‰äºæ ¸å¿ƒçº¿ç¨‹æ•°é‡ + éæ ¸å¿ƒçº¿ç¨‹æ•°é‡ã€‚</p></blockquote></li> <li><p><strong>long keepAliveTime</strong>ï¼š<strong>éæ ¸å¿ƒçº¿ç¨‹é—²ç½®è¶…æ—¶æ—¶é•¿</strong>ã€‚</p> <blockquote><p>éæ ¸å¿ƒçº¿ç¨‹å¦‚æœå¤„äºé—²ç½®çŠ¶æ€è¶…è¿‡è¯¥å€¼ï¼Œå°±ä¼šè¢«é”€æ¯ã€‚å¦‚æœè®¾ç½®allowCoreThreadTimeOut(true)ï¼Œåˆ™ä¼šä¹Ÿä½œç”¨äºæ ¸å¿ƒçº¿ç¨‹ã€‚</p></blockquote></li> <li><p><strong>TimeUnit unit</strong>ï¼škeepAliveTimeçš„å•ä½ã€‚</p></li></ul> <p>TimeUnitæ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹ ï¼ŒåŒ…æ‹¬ä»¥ä¸‹å±æ€§ï¼š</p> <blockquote><p>NANOSECONDS ï¼š 1å¾®æ¯«ç§’ = 1å¾®ç§’ / 1000 MICROSECONDS ï¼š 1å¾®ç§’ = 1æ¯«ç§’ / 1000 MILLISECONDS ï¼š 1æ¯«ç§’ = 1ç§’ /1000 SECONDS ï¼š ç§’ MINUTES ï¼š åˆ† HOURS ï¼š å°æ—¶ DAYS ï¼š å¤©</p></blockquote> <ul><li><p><strong>BlockingQueue workQueue</strong>ï¼šé˜»å¡é˜Ÿåˆ—ï¼Œç»´æŠ¤ç€<strong>ç­‰å¾…æ‰§è¡Œçš„Runnableä»»åŠ¡å¯¹è±¡</strong>ã€‚</p> <p>å¸¸ç”¨çš„å‡ ä¸ªé˜»å¡é˜Ÿåˆ—ï¼š</p> <ol><li><p><strong>LinkedBlockingQueue</strong></p> <p>é“¾å¼é˜»å¡é˜Ÿåˆ—ï¼Œåº•å±‚æ•°æ®ç»“æ„æ˜¯é“¾è¡¨ï¼Œé»˜è®¤å¤§å°æ˜¯<code>Integer.MAX_VALUE</code>ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå¤§å°ã€‚</p></li> <li><p><strong>ArrayBlockingQueue</strong></p> <p>æ•°ç»„é˜»å¡é˜Ÿåˆ—ï¼Œåº•å±‚æ•°æ®ç»“æ„æ˜¯æ•°ç»„ï¼Œéœ€è¦æŒ‡å®šé˜Ÿåˆ—çš„å¤§å°ã€‚</p></li> <li><p><strong>SynchronousQueue</strong></p> <p>åŒæ­¥é˜Ÿåˆ—ï¼Œå†…éƒ¨å®¹é‡ä¸º0ï¼Œæ¯ä¸ªputæ“ä½œå¿…é¡»ç­‰å¾…ä¸€ä¸ªtakeæ“ä½œï¼Œåä¹‹äº¦ç„¶ã€‚</p></li> <li><p><strong>DelayQueue</strong></p> <p>å»¶è¿Ÿé˜Ÿåˆ—ï¼Œè¯¥é˜Ÿåˆ—ä¸­çš„å…ƒç´ åªæœ‰å½“å…¶æŒ‡å®šçš„å»¶è¿Ÿæ—¶é—´åˆ°äº†ï¼Œæ‰èƒ½å¤Ÿä»é˜Ÿåˆ—ä¸­è·å–åˆ°è¯¥å…ƒç´  ã€‚</p></li></ol></li></ul> <blockquote><p>æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ç« ä¸­é‡ç‚¹ä»‹ç»å„ç§é˜»å¡é˜Ÿåˆ—</p></blockquote> <p>å¥½äº†ï¼Œä»‹ç»å®Œ5ä¸ªå¿…é¡»çš„å‚æ•°ä¹‹åï¼Œè¿˜æœ‰ä¸¤ä¸ªéå¿…é¡»çš„å‚æ•°ã€‚</p> <ul><li><p><strong>ThreadFactory threadFactory</strong></p> <p>åˆ›å»ºçº¿ç¨‹çš„å·¥å‚ ï¼Œç”¨äºæ‰¹é‡åˆ›å»ºçº¿ç¨‹ï¼Œç»Ÿä¸€åœ¨åˆ›å»ºçº¿ç¨‹æ—¶è®¾ç½®ä¸€äº›å‚æ•°ï¼Œå¦‚æ˜¯å¦å®ˆæŠ¤çº¿ç¨‹ã€çº¿ç¨‹çš„ä¼˜å…ˆçº§ç­‰ã€‚å¦‚æœä¸æŒ‡å®šï¼Œä¼šæ–°å»ºä¸€ä¸ªé»˜è®¤çš„çº¿ç¨‹å·¥å‚ã€‚</p></li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">DefaultThreadFactory</span> <span class="token keyword">implements</span> <span class="token class-name">ThreadFactory</span> <span class="token punctuation">{</span>
    <span class="token comment">// çœç•¥å±æ€§</span>
    <span class="token comment">// æ„é€ å‡½æ•°</span>
    <span class="token class-name">DefaultThreadFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SecurityManager</span> s <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        group <span class="token operator">=</span> <span class="token punctuation">(</span>s <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> s<span class="token punctuation">.</span><span class="token function">getThreadGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getThreadGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        namePrefix <span class="token operator">=</span> <span class="token string">&quot;pool-&quot;</span> <span class="token operator">+</span>
            poolNumber<span class="token punctuation">.</span><span class="token function">getAndIncrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>
            <span class="token string">&quot;-thread-&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// çœç•¥</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ul><li><p><strong>RejectedExecutionHandler handler</strong></p> <p><strong>æ‹’ç»å¤„ç†ç­–ç•¥</strong>ï¼Œçº¿ç¨‹æ•°é‡å¤§äºæœ€å¤§çº¿ç¨‹æ•°å°±ä¼šé‡‡ç”¨æ‹’ç»å¤„ç†ç­–ç•¥ï¼Œå››ç§æ‹’ç»å¤„ç†çš„ç­–ç•¥ä¸º ï¼š</p> <ol><li><strong>ThreadPoolExecutor.AbortPolicy</strong>ï¼š<strong>é»˜è®¤æ‹’ç»å¤„ç†ç­–ç•¥</strong>ï¼Œä¸¢å¼ƒä»»åŠ¡å¹¶æŠ›å‡ºRejectedExecutionExceptionå¼‚å¸¸ã€‚</li> <li><strong>ThreadPoolExecutor.DiscardPolicy</strong>ï¼šä¸¢å¼ƒæ–°æ¥çš„ä»»åŠ¡ï¼Œä½†æ˜¯ä¸æŠ›å‡ºå¼‚å¸¸ã€‚</li> <li><strong>ThreadPoolExecutor.DiscardOldestPolicy</strong>ï¼šä¸¢å¼ƒé˜Ÿåˆ—å¤´éƒ¨ï¼ˆæœ€æ—§çš„ï¼‰çš„ä»»åŠ¡ï¼Œç„¶åé‡æ–°å°è¯•æ‰§è¡Œç¨‹åºï¼ˆå¦‚æœå†æ¬¡å¤±è´¥ï¼Œé‡å¤æ­¤è¿‡ç¨‹ï¼‰ã€‚</li> <li><strong>ThreadPoolExecutor.CallerRunsPolicy</strong>ï¼šç”±è°ƒç”¨çº¿ç¨‹å¤„ç†è¯¥ä»»åŠ¡ã€‚</li></ol></li></ul> <h3 id="threadpoolexecutorçš„ç­–ç•¥"><a href="#threadpoolexecutorçš„ç­–ç•¥" class="header-anchor">#</a> ThreadPoolExecutorçš„ç­–ç•¥</h3> <p>çº¿ç¨‹æ± æœ¬èº«æœ‰ä¸€ä¸ªè°ƒåº¦çº¿ç¨‹ï¼Œè¿™ä¸ªçº¿ç¨‹å°±æ˜¯ç”¨äºç®¡ç†å¸ƒæ§æ•´ä¸ªçº¿ç¨‹æ± é‡Œçš„å„ç§ä»»åŠ¡å’Œäº‹åŠ¡ï¼Œä¾‹å¦‚åˆ›å»ºçº¿ç¨‹ã€é”€æ¯çº¿ç¨‹ã€ä»»åŠ¡é˜Ÿåˆ—ç®¡ç†ã€çº¿ç¨‹é˜Ÿåˆ—ç®¡ç†ç­‰ç­‰ã€‚</p> <p>æ•…çº¿ç¨‹æ± ä¹Ÿæœ‰è‡ªå·±çš„çŠ¶æ€ã€‚<code>ThreadPoolExecutor</code>ç±»ä¸­ä½¿ç”¨äº†ä¸€äº›<code>final int</code>å¸¸é‡å˜é‡æ¥è¡¨ç¤ºçº¿ç¨‹æ± çš„çŠ¶æ€ ï¼Œåˆ†åˆ«ä¸ºRUNNINGã€SHUTDOWNã€STOPã€TIDYING ã€TERMINATEDã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// runState is stored in the high-order bits</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">RUNNING</span>    <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token constant">COUNT_BITS</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">SHUTDOWN</span>   <span class="token operator">=</span>  <span class="token number">0</span> <span class="token operator">&lt;&lt;</span> <span class="token constant">COUNT_BITS</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">STOP</span>       <span class="token operator">=</span>  <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token constant">COUNT_BITS</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">TIDYING</span>    <span class="token operator">=</span>  <span class="token number">2</span> <span class="token operator">&lt;&lt;</span> <span class="token constant">COUNT_BITS</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">TERMINATED</span> <span class="token operator">=</span>  <span class="token number">3</span> <span class="token operator">&lt;&lt;</span> <span class="token constant">COUNT_BITS</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li><p>çº¿ç¨‹æ± åˆ›å»ºåå¤„äº<strong>RUNNING</strong>çŠ¶æ€ã€‚</p></li> <li><p>è°ƒç”¨shutdown()æ–¹æ³•åå¤„äº<strong>SHUTDOWN</strong>çŠ¶æ€ï¼Œçº¿ç¨‹æ± ä¸èƒ½æ¥å—æ–°çš„ä»»åŠ¡ï¼Œæ¸…é™¤ä¸€äº›ç©ºé—²worker,ä¸ä¼šç­‰å¾…é˜»å¡é˜Ÿåˆ—çš„ä»»åŠ¡å®Œæˆã€‚</p></li> <li><p>è°ƒç”¨shutdownNow()æ–¹æ³•åå¤„äº<strong>STOP</strong>çŠ¶æ€ï¼Œçº¿ç¨‹æ± ä¸èƒ½æ¥å—æ–°çš„ä»»åŠ¡ï¼Œä¸­æ–­æ‰€æœ‰çº¿ç¨‹ï¼Œé˜»å¡é˜Ÿåˆ—ä¸­æ²¡æœ‰è¢«æ‰§è¡Œçš„ä»»åŠ¡å…¨éƒ¨ä¸¢å¼ƒã€‚æ­¤æ—¶ï¼Œpoolsize=0,é˜»å¡é˜Ÿåˆ—çš„sizeä¹Ÿä¸º0ã€‚</p></li> <li><p>å½“æ‰€æœ‰çš„ä»»åŠ¡å·²ç»ˆæ­¢ï¼Œctlè®°å½•çš„â€ä»»åŠ¡æ•°é‡â€ä¸º0ï¼Œçº¿ç¨‹æ± ä¼šå˜ä¸º<strong>TIDYING</strong>çŠ¶æ€ã€‚æ¥ç€ä¼šæ‰§è¡Œterminated()å‡½æ•°ã€‚</p> <blockquote><p>ThreadPoolExecutorä¸­æœ‰ä¸€ä¸ªæ§åˆ¶çŠ¶æ€çš„å±æ€§å«<code>ctl</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ªAtomicIntegerç±»å‹çš„å˜é‡ã€‚çº¿ç¨‹æ± çŠ¶æ€å°±æ˜¯é€šè¿‡AtomicIntegerç±»å‹çš„æˆå‘˜å˜é‡<code>ctl</code>æ¥è·å–çš„ã€‚</p> <p>è·å–çš„<code>ctl</code>å€¼ä¼ å…¥<code>runStateOf</code>æ–¹æ³•ï¼Œä¸<code>~CAPACITY</code>ä½ä¸è¿ç®—(<code>CAPACITY</code>æ˜¯ä½29ä½å…¨1çš„intå˜é‡)ã€‚</p> <p><code>~CAPACITY</code>åœ¨è¿™é‡Œç›¸å½“äºæ©ç ï¼Œç”¨æ¥è·å–ctlçš„é«˜3ä½ï¼Œè¡¨ç¤ºçº¿ç¨‹æ± çŠ¶æ€ï¼›è€Œå¦å¤–çš„ä½29ä½ç”¨äºè¡¨ç¤ºå·¥ä½œçº¿ç¨‹æ•°</p></blockquote></li> <li><p>çº¿ç¨‹æ± å¤„åœ¨TIDYINGçŠ¶æ€æ—¶ï¼Œ<strong>æ‰§è¡Œå®Œterminated()æ–¹æ³•ä¹‹å</strong>ï¼Œå°±ä¼šç”± <strong>TIDYING -&gt; TERMINATED</strong>ï¼Œ çº¿ç¨‹æ± è¢«è®¾ç½®ä¸ºTERMINATEDçŠ¶æ€ã€‚</p></li></ul> <h3 id="çº¿ç¨‹æ± ä¸»è¦çš„ä»»åŠ¡å¤„ç†æµç¨‹"><a href="#çº¿ç¨‹æ± ä¸»è¦çš„ä»»åŠ¡å¤„ç†æµç¨‹" class="header-anchor">#</a> çº¿ç¨‹æ± ä¸»è¦çš„ä»»åŠ¡å¤„ç†æµç¨‹</h3> <p>å¤„ç†ä»»åŠ¡çš„æ ¸å¿ƒæ–¹æ³•æ˜¯<code>execute</code>ï¼Œæˆ‘ä»¬çœ‹çœ‹ JDK 1.8 æºç ä¸­<code>ThreadPoolExecutor</code>æ˜¯å¦‚ä½•å¤„ç†çº¿ç¨‹ä»»åŠ¡çš„ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// JDK 1.8 </span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> command<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>command <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
    <span class="token keyword">int</span> c <span class="token operator">=</span> ctl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 1.å½“å‰çº¿ç¨‹æ•°å°äºcorePoolSize,åˆ™è°ƒç”¨addWorkeråˆ›å»ºæ ¸å¿ƒçº¿ç¨‹æ‰§è¡Œä»»åŠ¡</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">workerCountOf</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">&lt;</span> corePoolSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">addWorker</span><span class="token punctuation">(</span>command<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
           <span class="token keyword">return</span><span class="token punctuation">;</span>
       c <span class="token operator">=</span> ctl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 2.å¦‚æœä¸å°äºcorePoolSizeï¼Œåˆ™å°†ä»»åŠ¡æ·»åŠ åˆ°workQueueé˜Ÿåˆ—ã€‚</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isRunning</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> workQueue<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> recheck <span class="token operator">=</span> ctl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2.1 å¦‚æœisRunningè¿”å›false(çŠ¶æ€æ£€æŸ¥)ï¼Œåˆ™removeè¿™ä¸ªä»»åŠ¡ï¼Œç„¶åæ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">isRunning</span><span class="token punctuation">(</span>recheck<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">remove</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token function">reject</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 2.2 çº¿ç¨‹æ± å¤„äºrunningçŠ¶æ€ï¼Œä½†æ˜¯æ²¡æœ‰çº¿ç¨‹ï¼Œåˆ™åˆ›å»ºçº¿ç¨‹</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">workerCountOf</span><span class="token punctuation">(</span>recheck<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token function">addWorker</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 3.å¦‚æœæ”¾å…¥workQueueå¤±è´¥ï¼Œåˆ™åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼Œ</span>
    <span class="token comment">// å¦‚æœè¿™æ—¶åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹å¤±è´¥(å½“å‰çº¿ç¨‹æ€»æ•°ä¸å°äºmaximumPoolSizeæ—¶)ï¼Œå°±ä¼šæ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">addWorker</span><span class="token punctuation">(</span>command<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
         <span class="token function">reject</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p><code>ctl.get()</code>æ˜¯è·å–çº¿ç¨‹æ± çŠ¶æ€ï¼Œç”¨<code>int</code>ç±»å‹è¡¨ç¤ºã€‚ç¬¬äºŒæ­¥ä¸­ï¼Œå…¥é˜Ÿå‰è¿›è¡Œäº†ä¸€æ¬¡<code>isRunning</code>åˆ¤æ–­ï¼Œå…¥é˜Ÿä¹‹åï¼Œåˆè¿›è¡Œäº†ä¸€æ¬¡<code>isRunning</code>åˆ¤æ–­ã€‚</p> <p><strong>ä¸ºä»€ä¹ˆè¦äºŒæ¬¡æ£€æŸ¥çº¿ç¨‹æ± çš„çŠ¶æ€?</strong></p> <p>åœ¨å¤šçº¿ç¨‹çš„ç¯å¢ƒä¸‹ï¼Œçº¿ç¨‹æ± çš„çŠ¶æ€æ˜¯æ—¶åˆ»å‘ç”Ÿå˜åŒ–çš„ã€‚å¾ˆæœ‰å¯èƒ½åˆšè·å–çº¿ç¨‹æ± çŠ¶æ€åçº¿ç¨‹æ± çŠ¶æ€å°±æ”¹å˜äº†ã€‚åˆ¤æ–­æ˜¯å¦å°†<code>command</code>åŠ å…¥<code>workqueue</code>æ˜¯çº¿ç¨‹æ± ä¹‹å‰çš„çŠ¶æ€ã€‚å€˜è‹¥æ²¡æœ‰äºŒæ¬¡æ£€æŸ¥ï¼Œä¸‡ä¸€çº¿ç¨‹æ± å¤„äºé<strong>RUNNING</strong>çŠ¶æ€ï¼ˆåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¾ˆæœ‰å¯èƒ½å‘ç”Ÿï¼‰ï¼Œé‚£ä¹ˆ<code>command</code>æ°¸è¿œä¸ä¼šæ‰§è¡Œã€‚</p> <p><strong>æ€»ç»“ä¸€ä¸‹å¤„ç†æµç¨‹</strong></p> <ol><li>çº¿ç¨‹æ€»æ•°é‡ &lt; corePoolSizeï¼Œæ— è®ºçº¿ç¨‹æ˜¯å¦ç©ºé—²ï¼Œéƒ½ä¼šæ–°å»ºä¸€ä¸ªæ ¸å¿ƒçº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼ˆè®©æ ¸å¿ƒçº¿ç¨‹æ•°é‡å¿«é€Ÿè¾¾åˆ°corePoolSizeï¼Œåœ¨æ ¸å¿ƒçº¿ç¨‹æ•°é‡ &lt; corePoolSizeæ—¶ï¼‰ã€‚<strong>æ³¨æ„ï¼Œè¿™ä¸€æ­¥éœ€è¦è·å¾—å…¨å±€é”ã€‚</strong></li> <li>çº¿ç¨‹æ€»æ•°é‡ &gt;= corePoolSizeæ—¶ï¼Œæ–°æ¥çš„çº¿ç¨‹ä»»åŠ¡ä¼šè¿›å…¥ä»»åŠ¡é˜Ÿåˆ—ä¸­ç­‰å¾…ï¼Œç„¶åç©ºé—²çš„æ ¸å¿ƒçº¿ç¨‹ä¼šä¾æ¬¡å»ç¼“å­˜é˜Ÿåˆ—ä¸­å–ä»»åŠ¡æ¥æ‰§è¡Œï¼ˆä½“ç°äº†<strong>çº¿ç¨‹å¤ç”¨</strong>ï¼‰ã€‚</li> <li>å½“ç¼“å­˜é˜Ÿåˆ—æ»¡äº†ï¼Œè¯´æ˜è¿™ä¸ªæ—¶å€™ä»»åŠ¡å·²ç»å¤šåˆ°çˆ†æ£šï¼Œéœ€è¦ä¸€äº›â€œä¸´æ—¶å·¥â€æ¥æ‰§è¡Œè¿™äº›ä»»åŠ¡äº†ã€‚äºæ˜¯ä¼šåˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹å»æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ã€‚<strong>æ³¨æ„ï¼Œè¿™ä¸€æ­¥éœ€è¦è·å¾—å…¨å±€é”ã€‚</strong></li> <li>ç¼“å­˜é˜Ÿåˆ—æ»¡äº†ï¼Œ ä¸”æ€»çº¿ç¨‹æ•°è¾¾åˆ°äº†maximumPoolSizeï¼Œåˆ™ä¼šé‡‡å–ä¸Šé¢æåˆ°çš„æ‹’ç»ç­–ç•¥è¿›è¡Œå¤„ç†ã€‚</li></ol> <p>æ•´ä¸ªè¿‡ç¨‹å¦‚å›¾æ‰€ç¤ºï¼š</p> <p><img src="https://fitminfpicgo.oss-cn-guangzhou.aliyuncs.com/picgo/202209291427779.png" alt="img"></p> <h3 id="threadpoolexecutorå¦‚ä½•åšåˆ°çº¿ç¨‹å¤ç”¨çš„"><a href="#threadpoolexecutorå¦‚ä½•åšåˆ°çº¿ç¨‹å¤ç”¨çš„" class="header-anchor">#</a> ThreadPoolExecutorå¦‚ä½•åšåˆ°çº¿ç¨‹å¤ç”¨çš„ï¼Ÿ</h3> <p>æˆ‘ä»¬çŸ¥é“ï¼Œä¸€ä¸ªçº¿ç¨‹åœ¨åˆ›å»ºçš„æ—¶å€™ä¼šæŒ‡å®šä¸€ä¸ªçº¿ç¨‹ä»»åŠ¡ï¼Œå½“æ‰§è¡Œå®Œè¿™ä¸ªçº¿ç¨‹ä»»åŠ¡ä¹‹åï¼Œçº¿ç¨‹è‡ªåŠ¨é”€æ¯ã€‚ä½†æ˜¯çº¿ç¨‹æ± å´å¯ä»¥å¤ç”¨çº¿ç¨‹ï¼Œå³ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œçº¿ç¨‹ä»»åŠ¡åä¸é”€æ¯ï¼Œç»§ç»­æ‰§è¡Œå¦å¤–çš„çº¿ç¨‹ä»»åŠ¡ã€‚<strong>é‚£ä¹ˆï¼Œçº¿ç¨‹æ± å¦‚ä½•åšåˆ°çº¿ç¨‹å¤ç”¨å‘¢ï¼Ÿ</strong></p> <p>åŸæ¥ï¼ŒThreadPoolExecutoråœ¨åˆ›å»ºçº¿ç¨‹æ—¶ï¼Œä¼šå°†çº¿ç¨‹å°è£…æˆ<strong>å·¥ä½œçº¿ç¨‹worker</strong>,å¹¶æ”¾å…¥<strong>å·¥ä½œçº¿ç¨‹ç»„</strong>ä¸­ï¼Œç„¶åè¿™ä¸ªworkeråå¤ä»é˜»å¡é˜Ÿåˆ—ä¸­æ‹¿ä»»åŠ¡å»æ‰§è¡Œã€‚è¯ä¸å¤šè¯´ï¼Œæˆ‘ä»¬ç»§ç»­çœ‹çœ‹æºç ï¼ˆä¸€å®šè¦ä»”ç»†çœ‹ï¼Œå‰åæœ‰è”ç³»ï¼‰</p> <p>è¿™é‡Œçš„<code>addWorker</code>æ–¹æ³•æ˜¯åœ¨ä¸Šé¢æåˆ°çš„<code>execute</code>æ–¹æ³•é‡Œé¢è°ƒç”¨çš„ï¼Œå…ˆçœ‹çœ‹ä¸ŠåŠéƒ¨åˆ†ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// ThreadPoolExecutor.addWorkeræ–¹æ³•æºç ä¸ŠåŠéƒ¨åˆ†</span>
<span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">addWorker</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> firstTask<span class="token punctuation">,</span> <span class="token keyword">boolean</span> core<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    retry<span class="token operator">:</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> c <span class="token operator">=</span> ctl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> rs <span class="token operator">=</span> <span class="token function">runStateOf</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Check if queue empty only if necessary.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>rs <span class="token operator">&gt;=</span> <span class="token constant">SHUTDOWN</span> <span class="token operator">&amp;&amp;</span>
            <span class="token operator">!</span> <span class="token punctuation">(</span>rs <span class="token operator">==</span> <span class="token constant">SHUTDOWN</span> <span class="token operator">&amp;&amp;</span>
               firstTask <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span>
               <span class="token operator">!</span> workQueue<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> wc <span class="token operator">=</span> <span class="token function">workerCountOf</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>wc <span class="token operator">&gt;=</span> <span class="token constant">CAPACITY</span> <span class="token operator">||</span>
                <span class="token comment">// 1.å¦‚æœcoreæ˜¯ture,è¯æ˜éœ€è¦åˆ›å»ºçš„çº¿ç¨‹ä¸ºæ ¸å¿ƒçº¿ç¨‹ï¼Œåˆ™å…ˆåˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦å¤§äºæ ¸å¿ƒçº¿ç¨‹</span>
                <span class="token comment">// å¦‚æœcoreæ˜¯false,è¯æ˜éœ€è¦åˆ›å»ºçš„æ˜¯éæ ¸å¿ƒçº¿ç¨‹ï¼Œåˆ™å…ˆåˆ¤æ–­å½“å‰çº¿ç¨‹æ•°æ˜¯å¦å¤§äºæ€»çº¿ç¨‹æ•°</span>
                <span class="token comment">// å¦‚æœä¸å°äºï¼Œåˆ™è¿”å›false</span>
                wc <span class="token operator">&gt;=</span> <span class="token punctuation">(</span>core <span class="token operator">?</span> corePoolSize <span class="token operator">:</span> maximumPoolSize<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">compareAndIncrementWorkerCount</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">break</span> retry<span class="token punctuation">;</span>
            c <span class="token operator">=</span> ctl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Re-read ctl</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">runStateOf</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">!=</span> rs<span class="token punctuation">)</span>
                <span class="token keyword">continue</span> retry<span class="token punctuation">;</span>
            <span class="token comment">// else CAS failed due to workerCount change; retry inner loop</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>ä¸ŠåŠéƒ¨åˆ†ä¸»è¦æ˜¯åˆ¤æ–­çº¿ç¨‹æ•°é‡æ˜¯å¦è¶…å‡ºé˜ˆå€¼ï¼Œè¶…è¿‡äº†å°±è¿”å›falseã€‚æˆ‘ä»¬ç»§ç»­çœ‹ä¸‹åŠéƒ¨åˆ†:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token comment">// ThreadPoolExecutor.addWorkeræ–¹æ³•æºç ä¸‹åŠéƒ¨åˆ†</span>
    <span class="token keyword">boolean</span> workerStarted <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> workerAdded <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token class-name">Worker</span> w <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1.åˆ›å»ºä¸€ä¸ªworkerå¯¹è±¡</span>
        w <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span>firstTask<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2.å®ä¾‹åŒ–ä¸€ä¸ªThreadå¯¹è±¡</span>
        <span class="token keyword">final</span> <span class="token class-name">Thread</span> t <span class="token operator">=</span> w<span class="token punctuation">.</span>thread<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 3.çº¿ç¨‹æ± å…¨å±€é”</span>
            <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> mainLock <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mainLock<span class="token punctuation">;</span>
            mainLock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">// Recheck while holding lock.</span>
                <span class="token comment">// Back out on ThreadFactory failure or if</span>
                <span class="token comment">// shut down before lock acquired.</span>
                <span class="token keyword">int</span> rs <span class="token operator">=</span> <span class="token function">runStateOf</span><span class="token punctuation">(</span>ctl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>rs <span class="token operator">&lt;</span> <span class="token constant">SHUTDOWN</span> <span class="token operator">||</span>
                    <span class="token punctuation">(</span>rs <span class="token operator">==</span> <span class="token constant">SHUTDOWN</span> <span class="token operator">&amp;&amp;</span> firstTask <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">isAlive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// precheck that t is startable</span>
                        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalThreadStateException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    workers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">int</span> s <span class="token operator">=</span> workers<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>s <span class="token operator">&gt;</span> largestPoolSize<span class="token punctuation">)</span>
                        largestPoolSize <span class="token operator">=</span> s<span class="token punctuation">;</span>
                    workerAdded <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                mainLock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>workerAdded<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 4.å¯åŠ¨è¿™ä¸ªçº¿ç¨‹</span>
                t<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                workerStarted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> workerStarted<span class="token punctuation">)</span>
            <span class="token function">addWorkerFailed</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> workerStarted<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><p>åˆ›å»º<code>worker</code>å¯¹è±¡ï¼Œå¹¶åˆå§‹åŒ–ä¸€ä¸ª<code>Thread</code>å¯¹è±¡ï¼Œç„¶åå¯åŠ¨è¿™ä¸ªçº¿ç¨‹å¯¹è±¡ã€‚</p> <p>æˆ‘ä»¬æ¥ç€çœ‹çœ‹<code>Worker</code>ç±»ï¼Œä»…å±•ç¤ºéƒ¨åˆ†æºç ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Workerç±»éƒ¨åˆ†æºç </span>
<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Worker</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractQueuedSynchronizer</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span><span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token class-name">Thread</span> thread<span class="token punctuation">;</span>
    <span class="token class-name">Runnable</span> firstTask<span class="token punctuation">;</span>

    <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> firstTask<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setState</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// inhibit interrupts until runWorker</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>firstTask <span class="token operator">=</span> firstTask<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>thread <span class="token operator">=</span> <span class="token function">getThreadFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newThread</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">runWorker</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//å…¶ä½™ä»£ç ç•¥...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><code>Worker</code>ç±»å®ç°äº†<code>Runnable</code>æ¥å£ï¼Œæ‰€ä»¥<code>Worker</code>ä¹Ÿæ˜¯ä¸€ä¸ªçº¿ç¨‹ä»»åŠ¡ã€‚åœ¨æ„é€ æ–¹æ³•ä¸­ï¼Œåˆ›å»ºäº†ä¸€ä¸ªçº¿ç¨‹ï¼Œçº¿ç¨‹çš„ä»»åŠ¡å°±æ˜¯è‡ªå·±ã€‚æ•…<code>addWorker</code>æ–¹æ³•è°ƒç”¨addWorkeræ–¹æ³•æºç ä¸‹åŠéƒ¨åˆ†ä¸­çš„ç¬¬4æ­¥<code>t.start</code>ï¼Œä¼šè§¦å‘<code>Worker</code>ç±»çš„<code>run</code>æ–¹æ³•è¢«JVMè°ƒç”¨ã€‚</p> <p>æˆ‘ä»¬å†çœ‹çœ‹<code>runWorker</code>çš„é€»è¾‘ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Worker.runWorkeræ–¹æ³•æºä»£ç </span>
<span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">runWorker</span><span class="token punctuation">(</span><span class="token class-name">Worker</span> w<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Thread</span> wt <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Runnable</span> task <span class="token operator">=</span> w<span class="token punctuation">.</span>firstTask<span class="token punctuation">;</span>
    w<span class="token punctuation">.</span>firstTask <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token comment">// 1.çº¿ç¨‹å¯åŠ¨ä¹‹åï¼Œé€šè¿‡unlockæ–¹æ³•é‡Šæ”¾é”</span>
    w<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// allow interrupts</span>
    <span class="token keyword">boolean</span> completedAbruptly <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// 2.Workeræ‰§è¡ŒfirstTaskæˆ–ä»workQueueä¸­è·å–ä»»åŠ¡ï¼Œå¦‚æœgetTaskæ–¹æ³•ä¸è¿”å›null,å¾ªç¯ä¸é€€å‡º</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>task <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token punctuation">(</span>task <span class="token operator">=</span> <span class="token function">getTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 2.1è¿›è¡ŒåŠ é”æ“ä½œï¼Œä¿è¯threadä¸è¢«å…¶ä»–çº¿ç¨‹ä¸­æ–­ï¼ˆé™¤éçº¿ç¨‹æ± è¢«ä¸­æ–­ï¼‰</span>
            w<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// If pool is stopping, ensure thread is interrupted;</span>
            <span class="token comment">// if not, ensure thread is not interrupted.  This</span>
            <span class="token comment">// requires a recheck in second case to deal with</span>
            <span class="token comment">// shutdownNow race while clearing interrupt</span>
            <span class="token comment">// 2.2æ£€æŸ¥çº¿ç¨‹æ± çŠ¶æ€ï¼Œå€˜è‹¥çº¿ç¨‹æ± å¤„äºä¸­æ–­çŠ¶æ€ï¼Œå½“å‰çº¿ç¨‹å°†ä¸­æ–­ã€‚ </span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">runStateAtLeast</span><span class="token punctuation">(</span>ctl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">STOP</span><span class="token punctuation">)</span> <span class="token operator">||</span>
                 <span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">interrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
                  <span class="token function">runStateAtLeast</span><span class="token punctuation">(</span>ctl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">STOP</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
                <span class="token operator">!</span>wt<span class="token punctuation">.</span><span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                wt<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">// 2.3æ‰§è¡ŒbeforeExecute </span>
                <span class="token function">beforeExecute</span><span class="token punctuation">(</span>wt<span class="token punctuation">,</span> task<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Throwable</span> thrown <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 2.4æ‰§è¡Œä»»åŠ¡</span>
                    task<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RuntimeException</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    thrown <span class="token operator">=</span> x<span class="token punctuation">;</span> <span class="token keyword">throw</span> x<span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Error</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    thrown <span class="token operator">=</span> x<span class="token punctuation">;</span> <span class="token keyword">throw</span> x<span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    thrown <span class="token operator">=</span> x<span class="token punctuation">;</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 2.5æ‰§è¡ŒafterExecuteæ–¹æ³• </span>
                    <span class="token function">afterExecute</span><span class="token punctuation">(</span>task<span class="token punctuation">,</span> thrown<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                task <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                w<span class="token punctuation">.</span>completedTasks<span class="token operator">++</span><span class="token punctuation">;</span>
                <span class="token comment">// 2.6è§£é”æ“ä½œ</span>
                w<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        completedAbruptly <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        <span class="token function">processWorkerExit</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> completedAbruptly<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><p>é¦–å…ˆå»æ‰§è¡Œåˆ›å»ºè¿™ä¸ªworkeræ—¶å°±æœ‰çš„ä»»åŠ¡ï¼Œå½“æ‰§è¡Œå®Œè¿™ä¸ªä»»åŠ¡åï¼Œworkerçš„ç”Ÿå‘½å‘¨æœŸå¹¶æ²¡æœ‰ç»“æŸï¼Œåœ¨<code>while</code>å¾ªç¯ä¸­ï¼Œworkerä¼šä¸æ–­åœ°è°ƒç”¨<code>getTask</code>æ–¹æ³•ä»<strong>é˜»å¡é˜Ÿåˆ—</strong>ä¸­è·å–ä»»åŠ¡ç„¶åè°ƒç”¨<code>task.run()</code>æ‰§è¡Œä»»åŠ¡,ä»è€Œè¾¾åˆ°<strong>å¤ç”¨çº¿ç¨‹</strong>çš„ç›®çš„ã€‚åªè¦<code>getTask</code>æ–¹æ³•ä¸è¿”å›<code>null</code>,æ­¤çº¿ç¨‹å°±ä¸ä¼šé€€å‡ºã€‚</p> <p>å½“ç„¶ï¼Œæ ¸å¿ƒçº¿ç¨‹æ± ä¸­åˆ›å»ºçš„çº¿ç¨‹æƒ³è¦æ‹¿åˆ°é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œå…ˆè¦åˆ¤æ–­çº¿ç¨‹æ± çš„çŠ¶æ€ï¼Œå¦‚æœ<strong>STOP</strong>æˆ–è€…<strong>TERMINATED</strong>ï¼Œè¿”å›<code>null</code>ã€‚</p> <p>æœ€åçœ‹çœ‹<code>getTask</code>æ–¹æ³•çš„å®ç°:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Worker.getTaskæ–¹æ³•æºç </span>
<span class="token keyword">private</span> <span class="token class-name">Runnable</span> <span class="token function">getTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">boolean</span> timedOut <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// Did the last poll() time out?</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> c <span class="token operator">=</span> ctl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> rs <span class="token operator">=</span> <span class="token function">runStateOf</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Check if queue empty only if necessary.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>rs <span class="token operator">&gt;=</span> <span class="token constant">SHUTDOWN</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>rs <span class="token operator">&gt;=</span> <span class="token constant">STOP</span> <span class="token operator">||</span> workQueue<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">decrementWorkerCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">int</span> wc <span class="token operator">=</span> <span class="token function">workerCountOf</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Are workers subject to culling?</span>
        <span class="token comment">// 1.allowCoreThreadTimeOutå˜é‡é»˜è®¤æ˜¯false,æ ¸å¿ƒçº¿ç¨‹å³ä½¿ç©ºé—²ä¹Ÿä¸ä¼šè¢«é”€æ¯</span>
        <span class="token comment">// å¦‚æœä¸ºtrue,æ ¸å¿ƒçº¿ç¨‹åœ¨keepAliveTimeå†…ä»ç©ºé—²åˆ™ä¼šè¢«é”€æ¯ã€‚ </span>
        <span class="token keyword">boolean</span> timed <span class="token operator">=</span> allowCoreThreadTimeOut <span class="token operator">||</span> wc <span class="token operator">&gt;</span> corePoolSize<span class="token punctuation">;</span>
        <span class="token comment">// 2.å¦‚æœè¿è¡Œçº¿ç¨‹æ•°è¶…è¿‡äº†æœ€å¤§çº¿ç¨‹æ•°ï¼Œä½†æ˜¯ç¼“å­˜é˜Ÿåˆ—å·²ç»ç©ºäº†ï¼Œè¿™æ—¶é€’å‡workeræ•°é‡ã€‚ </span>
ã€€ã€€ã€€ã€€ <span class="token comment">// å¦‚æœæœ‰è®¾ç½®å…è®¸çº¿ç¨‹è¶…æ—¶æˆ–è€…çº¿ç¨‹æ•°é‡è¶…è¿‡äº†æ ¸å¿ƒçº¿ç¨‹æ•°é‡ï¼Œ</span>
        <span class="token comment">// å¹¶ä¸”çº¿ç¨‹åœ¨è§„å®šæ—¶é—´å†…å‡æœªpollåˆ°ä»»åŠ¡ä¸”é˜Ÿåˆ—ä¸ºç©ºåˆ™é€’å‡workeræ•°é‡</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>wc <span class="token operator">&gt;</span> maximumPoolSize <span class="token operator">||</span> <span class="token punctuation">(</span>timed <span class="token operator">&amp;&amp;</span> timedOut<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>wc <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">||</span> workQueue<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">compareAndDecrementWorkerCount</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// 3.å¦‚æœtimedä¸ºtrue(æƒ³æƒ³å“ªäº›æƒ…å†µä¸‹timedä¸ºtrue),åˆ™ä¼šè°ƒç”¨workQueueçš„pollæ–¹æ³•è·å–ä»»åŠ¡.</span>
            <span class="token comment">// è¶…æ—¶æ—¶é—´æ˜¯keepAliveTimeã€‚å¦‚æœè¶…è¿‡keepAliveTimeæ—¶é•¿ï¼Œ</span>
            <span class="token comment">// pollè¿”å›äº†nullï¼Œä¸Šè¾¹æåˆ°çš„whileå¾ªåºå°±ä¼šé€€å‡ºï¼Œçº¿ç¨‹ä¹Ÿå°±æ‰§è¡Œå®Œäº†ã€‚</span>
            <span class="token comment">// å¦‚æœtimedä¸ºfalseï¼ˆallowCoreThreadTimeOutä¸ºfalse</span>
            <span class="token comment">// ä¸”wc &gt; corePoolSizeä¸ºfalseï¼‰ï¼Œåˆ™ä¼šè°ƒç”¨workQueueçš„takeæ–¹æ³•é˜»å¡åœ¨å½“å‰ã€‚</span>
            <span class="token comment">// é˜Ÿåˆ—ä¸­æœ‰ä»»åŠ¡åŠ å…¥æ—¶ï¼Œçº¿ç¨‹è¢«å”¤é†’ï¼Œtakeæ–¹æ³•è¿”å›ä»»åŠ¡ï¼Œå¹¶æ‰§è¡Œã€‚</span>
            <span class="token class-name">Runnable</span> r <span class="token operator">=</span> timed <span class="token operator">?</span>
                workQueue<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span>keepAliveTime<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">NANOSECONDS</span><span class="token punctuation">)</span> <span class="token operator">:</span>
                workQueue<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>r <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> r<span class="token punctuation">;</span>
            timedOut <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> retry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            timedOut <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><p>æ ¸å¿ƒçº¿ç¨‹çš„ä¼šä¸€ç›´å¡åœ¨<code>workQueue.take</code>æ–¹æ³•ï¼Œè¢«é˜»å¡å¹¶æŒ‚èµ·ï¼Œä¸ä¼šå ç”¨CPUèµ„æºï¼Œç›´åˆ°æ‹¿åˆ°<code>Runnable</code> ç„¶åè¿”å›ï¼ˆå½“ç„¶å¦‚æœ<strong>allowCoreThreadTimeOut</strong>è®¾ç½®ä¸º<code>true</code>,é‚£ä¹ˆæ ¸å¿ƒçº¿ç¨‹å°±ä¼šå»è°ƒç”¨<code>poll</code>æ–¹æ³•ï¼Œå› ä¸º<code>poll</code>å¯èƒ½ä¼šè¿”å›<code>null</code>,æ‰€ä»¥è¿™æ—¶å€™æ ¸å¿ƒçº¿ç¨‹æ»¡è¶³è¶…æ—¶æ¡ä»¶ä¹Ÿä¼šè¢«é”€æ¯ï¼‰ã€‚</p> <p>éæ ¸å¿ƒçº¿ç¨‹ä¼šworkQueue.poll(keepAliveTime, TimeUnit.NANOSECONDS) ï¼Œå¦‚æœè¶…æ—¶è¿˜æ²¡æœ‰æ‹¿åˆ°ï¼Œä¸‹ä¸€æ¬¡å¾ªç¯åˆ¤æ–­<strong>compareAndDecrementWorkerCount</strong>å°±ä¼šè¿”å›<code>null</code>,Workerå¯¹è±¡çš„<code>run()</code>æ–¹æ³•å¾ªç¯ä½“çš„åˆ¤æ–­ä¸º<code>null</code>,ä»»åŠ¡ç»“æŸï¼Œç„¶åçº¿ç¨‹è¢«ç³»ç»Ÿå›æ”¶ ã€‚</p> <p>æºç è§£æå®Œæ¯•ï¼Œä½ ç†è§£çš„æºç æ˜¯å¦å’Œå›¾ä¸­çš„å¤„ç†æµç¨‹ä¸€è‡´ï¼Ÿå¦‚æœä¸ä¸€è‡´ï¼Œé‚£ä¹ˆå°±å¤šçœ‹ä¸¤éå§ï¼ŒåŠ æ²¹ã€‚</p> <h2 id="å››ç§å¸¸è§çš„çº¿ç¨‹æ± "><a href="#å››ç§å¸¸è§çš„çº¿ç¨‹æ± " class="header-anchor">#</a> å››ç§å¸¸è§çš„çº¿ç¨‹æ± </h2> <p><code>Executors</code>ç±»ä¸­æä¾›çš„å‡ ä¸ªé™æ€æ–¹æ³•æ¥åˆ›å»ºçº¿ç¨‹æ± ã€‚å¤§å®¶åˆ°äº†è¿™ä¸€æ­¥ï¼Œå¦‚æœçœ‹æ‡‚äº†å‰é¢è®²çš„<code>ThreadPoolExecutor</code>æ„é€ æ–¹æ³•ä¸­å„ç§å‚æ•°çš„æ„ä¹‰ï¼Œé‚£ä¹ˆä¸€çœ‹åˆ°<code>Executors</code>ç±»ä¸­æä¾›çš„çº¿ç¨‹æ± çš„æºç å°±åº”è¯¥çŸ¥é“è¿™ä¸ªçº¿ç¨‹æ± æ˜¯å¹²å˜›çš„ã€‚</p> <h3 id="newcachedthreadpool"><a href="#newcachedthreadpool" class="header-anchor">#</a> newCachedThreadPool</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ExecutorService</span> <span class="token function">newCachedThreadPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">,</span>
                                  <span class="token number">60L</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">,</span>
                                  <span class="token keyword">new</span> <span class="token class-name">SynchronousQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><code>CacheThreadPool</code>çš„<strong>è¿è¡Œæµç¨‹</strong>å¦‚ä¸‹ï¼š</p> <ol><li>æäº¤ä»»åŠ¡è¿›çº¿ç¨‹æ± ã€‚</li> <li>å› ä¸º<strong>corePoolSize</strong>ä¸º0çš„å…³ç³»ï¼Œä¸åˆ›å»ºæ ¸å¿ƒçº¿ç¨‹ï¼Œçº¿ç¨‹æ± æœ€å¤§ä¸ºInteger.MAX_VALUEã€‚</li> <li>å°è¯•å°†ä»»åŠ¡æ·»åŠ åˆ°<strong>SynchronousQueue</strong>é˜Ÿåˆ—ã€‚</li> <li>å¦‚æœSynchronousQueueå…¥åˆ—æˆåŠŸï¼Œç­‰å¾…è¢«å½“å‰è¿è¡Œçš„çº¿ç¨‹ç©ºé—²åæ‹‰å–æ‰§è¡Œã€‚å¦‚æœå½“å‰æ²¡æœ‰ç©ºé—²çº¿ç¨‹ï¼Œé‚£ä¹ˆå°±åˆ›å»ºä¸€ä¸ªéæ ¸å¿ƒçº¿ç¨‹ï¼Œç„¶åä»SynchronousQueueæ‹‰å–ä»»åŠ¡å¹¶åœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œã€‚</li> <li>å¦‚æœSynchronousQueueå·²æœ‰ä»»åŠ¡åœ¨ç­‰å¾…ï¼Œå…¥åˆ—æ“ä½œå°†ä¼šé˜»å¡ã€‚</li></ol> <p>å½“éœ€è¦æ‰§è¡Œå¾ˆå¤š<strong>çŸ­æ—¶é—´</strong>çš„ä»»åŠ¡æ—¶ï¼ŒCacheThreadPoolçš„çº¿ç¨‹å¤ç”¨ç‡æ¯”è¾ƒé«˜ï¼Œ ä¼šæ˜¾è‘—çš„<strong>æé«˜æ€§èƒ½</strong>ã€‚è€Œä¸”çº¿ç¨‹60såä¼šå›æ”¶ï¼Œæ„å‘³ç€å³ä½¿æ²¡æœ‰ä»»åŠ¡è¿›æ¥ï¼ŒCacheThreadPoolå¹¶ä¸ä¼šå ç”¨å¾ˆå¤šèµ„æºã€‚</p> <h3 id="newfixedthreadpool"><a href="#newfixedthreadpool" class="header-anchor">#</a> newFixedThreadPool</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ExecutorService</span> <span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token keyword">int</span> nThreads<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span>nThreads<span class="token punctuation">,</span> nThreads<span class="token punctuation">,</span>
                                      <span class="token number">0L</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">MILLISECONDS</span><span class="token punctuation">,</span>
                                      <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>æ ¸å¿ƒçº¿ç¨‹æ•°é‡å’Œæ€»çº¿ç¨‹æ•°é‡ç›¸ç­‰ï¼Œéƒ½æ˜¯ä¼ å…¥çš„å‚æ•°nThreadsï¼Œæ‰€ä»¥åªèƒ½åˆ›å»ºæ ¸å¿ƒçº¿ç¨‹ï¼Œä¸èƒ½åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹ã€‚å› ä¸ºLinkedBlockingQueueçš„é»˜è®¤å¤§å°æ˜¯Integer.MAX_VALUEï¼Œæ•…å¦‚æœæ ¸å¿ƒçº¿ç¨‹ç©ºé—²ï¼Œåˆ™äº¤ç»™æ ¸å¿ƒçº¿ç¨‹å¤„ç†ï¼›å¦‚æœæ ¸å¿ƒçº¿ç¨‹ä¸ç©ºé—²ï¼Œåˆ™å…¥åˆ—ç­‰å¾…ï¼Œç›´åˆ°æ ¸å¿ƒçº¿ç¨‹ç©ºé—²ã€‚</p> <p><strong>ä¸CachedThreadPoolçš„åŒºåˆ«</strong>ï¼š</p> <ul><li>å› ä¸º corePoolSize == maximumPoolSize ï¼Œæ‰€ä»¥FixedThreadPoolåªä¼šåˆ›å»ºæ ¸å¿ƒçº¿ç¨‹ã€‚ è€ŒCachedThreadPoolå› ä¸ºcorePoolSize=0ï¼Œæ‰€ä»¥åªä¼šåˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹ã€‚</li> <li>åœ¨ getTask() æ–¹æ³•ï¼Œå¦‚æœé˜Ÿåˆ—é‡Œæ²¡æœ‰ä»»åŠ¡å¯å–ï¼Œçº¿ç¨‹ä¼šä¸€ç›´é˜»å¡åœ¨ LinkedBlockingQueue.take() ï¼Œçº¿ç¨‹ä¸ä¼šè¢«å›æ”¶ã€‚ CachedThreadPoolä¼šåœ¨60såæ”¶å›ã€‚</li> <li>ç”±äºçº¿ç¨‹ä¸ä¼šè¢«å›æ”¶ï¼Œä¼šä¸€ç›´å¡åœ¨é˜»å¡ï¼Œæ‰€ä»¥<strong>æ²¡æœ‰ä»»åŠ¡çš„æƒ…å†µä¸‹ï¼Œ FixedThreadPoolå ç”¨èµ„æºæ›´å¤š</strong>ã€‚</li> <li>éƒ½å‡ ä¹ä¸ä¼šè§¦å‘æ‹’ç»ç­–ç•¥ï¼Œä½†æ˜¯åŸç†ä¸åŒã€‚FixedThreadPoolæ˜¯å› ä¸ºé˜»å¡é˜Ÿåˆ—å¯ä»¥å¾ˆå¤§ï¼ˆæœ€å¤§ä¸ºIntegeræœ€å¤§å€¼ï¼‰ï¼Œæ•…å‡ ä¹ä¸ä¼šè§¦å‘æ‹’ç»ç­–ç•¥ï¼›CachedThreadPoolæ˜¯å› ä¸ºçº¿ç¨‹æ± å¾ˆå¤§ï¼ˆæœ€å¤§ä¸ºIntegeræœ€å¤§å€¼ï¼‰ï¼Œå‡ ä¹ä¸ä¼šå¯¼è‡´çº¿ç¨‹æ•°é‡å¤§äºæœ€å¤§çº¿ç¨‹æ•°ï¼Œæ•…å‡ ä¹ä¸ä¼šè§¦å‘æ‹’ç»ç­–ç•¥ã€‚</li></ul> <h3 id="newsinglethreadexecutor"><a href="#newsinglethreadexecutor" class="header-anchor">#</a> newSingleThreadExecutor</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ExecutorService</span> <span class="token function">newSingleThreadExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">FinalizableDelegatedExecutorService</span>
        <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
                                <span class="token number">0L</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">MILLISECONDS</span><span class="token punctuation">,</span>
                                <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªæ ¸å¿ƒçº¿ç¨‹ï¼ˆ corePoolSize == maximumPoolSize=1ï¼‰ï¼Œä½¿ç”¨äº†LinkedBlockingQueueï¼ˆå®¹é‡å¾ˆå¤§ï¼‰ï¼Œæ‰€ä»¥ï¼Œ<strong>ä¸ä¼šåˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹</strong>ã€‚æ‰€æœ‰ä»»åŠ¡æŒ‰ç…§<strong>å…ˆæ¥å…ˆæ‰§è¡Œ</strong>çš„é¡ºåºæ‰§è¡Œã€‚å¦‚æœè¿™ä¸ªå”¯ä¸€çš„çº¿ç¨‹ä¸ç©ºé—²ï¼Œé‚£ä¹ˆæ–°æ¥çš„ä»»åŠ¡ä¼šå­˜å‚¨åœ¨ä»»åŠ¡é˜Ÿåˆ—é‡Œç­‰å¾…æ‰§è¡Œã€‚</p> <h3 id="newscheduledthreadpool"><a href="#newscheduledthreadpool" class="header-anchor">#</a> newScheduledThreadPool</h3> <p>åˆ›å»ºä¸€ä¸ªå®šé•¿çº¿ç¨‹æ± ï¼Œæ”¯æŒå®šæ—¶åŠå‘¨æœŸæ€§ä»»åŠ¡æ‰§è¡Œã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ScheduledExecutorService</span> <span class="token function">newScheduledThreadPool</span><span class="token punctuation">(</span><span class="token keyword">int</span> corePoolSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ScheduledThreadPoolExecutor</span><span class="token punctuation">(</span>corePoolSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//ScheduledThreadPoolExecutor():</span>
<span class="token keyword">public</span> <span class="token class-name">ScheduledThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token keyword">int</span> corePoolSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>corePoolSize<span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">,</span>
          <span class="token constant">DEFAULT_KEEPALIVE_MILLIS</span><span class="token punctuation">,</span> <span class="token constant">MILLISECONDS</span><span class="token punctuation">,</span>
          <span class="token keyword">new</span> <span class="token class-name">DelayedWorkQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>å››ç§å¸¸è§çš„çº¿ç¨‹æ± åŸºæœ¬å¤Ÿæˆ‘ä»¬ä½¿ç”¨äº†ï¼Œä½†æ˜¯ã€Šé˜¿é‡Œå·´å·´å¼€å‘æ‰‹å†Œã€‹ä¸å»ºè®®æˆ‘ä»¬ç›´æ¥ä½¿ç”¨Executorsç±»ä¸­çš„çº¿ç¨‹æ± ï¼Œè€Œæ˜¯é€šè¿‡<code>ThreadPoolExecutor</code>çš„æ–¹å¼ï¼Œè¿™æ ·çš„å¤„ç†æ–¹å¼è®©å†™çš„åŒå­¦éœ€è¦æ›´åŠ æ˜ç¡®çº¿ç¨‹æ± çš„è¿è¡Œè§„åˆ™ï¼Œè§„é¿èµ„æºè€—å°½çš„é£é™©ã€‚</p> <p>ä½†å¦‚æœä½ åŠå›¢é˜Ÿæœ¬èº«å¯¹çº¿ç¨‹æ± éå¸¸ç†Ÿæ‚‰ï¼Œåˆç¡®å®šä¸šåŠ¡è§„æ¨¡ä¸ä¼šå¤§åˆ°èµ„æºè€—å°½çš„ç¨‹åº¦ï¼ˆæ¯”å¦‚çº¿ç¨‹æ•°é‡æˆ–ä»»åŠ¡é˜Ÿåˆ—é•¿åº¦å¯èƒ½è¾¾åˆ°Integer.MAX_VALUEï¼‰æ—¶ï¼Œå…¶å®æ˜¯å¯ä»¥ä½¿ç”¨JDKæä¾›çš„è¿™å‡ ä¸ªæ¥å£çš„ï¼Œå®ƒèƒ½è®©æˆ‘ä»¬çš„ä»£ç å…·æœ‰æ›´å¼ºçš„å¯è¯»æ€§ã€‚</p></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/Fitminf/edit/master/docs/01.åç«¯/30.å¹¶å‘/10.å¤šçº¿ç¨‹åŸºç¡€/12.çº¿ç¨‹æ± åŸç†.md" target="_blank" rel="noopener noreferrer">ç¼–è¾‘</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="tags"><a href="/blog/tags/?tag=%E5%B9%B6%E5%8F%91" title="æ ‡ç­¾">#å¹¶å‘</a></div> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°:</span> <span class="time">2022/09/29, 15:24:13</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/blog/pages/E658D79B41195139/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">11ã€AQS</div></a> <a href="/blog/pages/345A4BC7620A2B1A/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">13ã€é˜»å¡é˜Ÿåˆ—</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        â†
        <a href="/blog/pages/E658D79B41195139/" class="prev">11ã€AQS</a></span> <span class="next"><a href="/blog/pages/345A4BC7620A2B1A/">13ã€é˜»å¡é˜Ÿåˆ—</a>â†’
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/blog/archives/" class="iconfont icon-bi">æœ€è¿‘æ›´æ–°</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/blog/pages/97DB848CDF0349FE/"><div>
            20ã€è®¡åˆ’ä»»åŠ¡
            <!----></div></a> <span class="date">09-29</span></dt></dl><dl><dd>02</dd> <dt><a href="/blog/pages/7EBF85E5E461278E/"><div>
            19ã€Java 8 Streamå¹¶è¡Œè®¡ç®—åŸç†
            <!----></div></a> <span class="date">09-29</span></dt></dl><dl><dd>03</dd> <dt><a href="/blog/pages/ADD7D4486BAD1826/"><div>
            18ã€Forkã€Joinæ¡†æ¶
            <!----></div></a> <span class="date">09-29</span></dt></dl> <dl><dd></dd> <dt><a href="/blog/archives/" class="more">æ›´å¤šæ–‡ç« &gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:fitminf@163.com" title="å‘é‚®ä»¶" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/Fitminf" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="å¬éŸ³ä¹" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="æœ¬ç«™ä¸»é¢˜">Vdoing</a> 
    | Copyright Â© 2022-2022
    <span>Fitminf | <a href="https://gitee.com/fitminf" target="_blank">Fitminf License</a></span></div> <div class="buttons"><div title="è¿”å›é¡¶éƒ¨" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="å»è¯„è®º" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="ä¸»é¢˜æ¨¡å¼" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          è·Ÿéšç³»ç»Ÿ
        </li><li class="iconfont icon-rijianmoshi">
          æµ…è‰²æ¨¡å¼
        </li><li class="iconfont icon-yejianmoshi">
          æ·±è‰²æ¨¡å¼
        </li><li class="iconfont icon-yuedu">
          é˜…è¯»æ¨¡å¼
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.efd2e688.js" defer></script><script src="/blog/assets/js/2.5f0b0e2a.js" defer></script><script src="/blog/assets/js/26.6c5d9435.js" defer></script>
  </body>
</html>
